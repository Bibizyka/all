
B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 1



 0000                   1  $Include 'gpgtregs.inc'
                        2   ; 68HC908GT16/GP32 Equates
                        3  
 0000                   4  PTA    EQU $0000     ; Ports and data direction
 0000                   5  PORTA  EQU $0000
 0000                   6  PTB    EQU $0001
 0000                   7  PORTB  EQU $0001
 0000                   8  PTC    EQU $0002
 0000                   9  PORTC  EQU $0002
 0000                  10  PTD    EQU $0003
 0000                  11  PORTD  EQU $0003
 0000                  12  DDRA   EQU $0004
 0000                  13  DDRB   EQU $0005
 0000                  14  DDRC   EQU $0006
 0000                  15  DDRD   EQU $0007
 0000                  16  PTE    EQU $0008
 0000                  17  PORTE  EQU $0008
                       18  
 0000                  19  SCPSC   EQU $0009    ;GT16 Only - Enhanced SCI
 0000                  20  SCIACTL EQU $000A    ;GT16 Only
 0000                  21  SCIADAT EQU $000B    ;GT16 Only
                       22  
 0000                  23  DDRE    EQU $000C    ; Ports and data direction
                       24  
 0000                  25  PTAPUE  EQU $000D    ; Port pull-up enables
 0000                  26  PTCPUE  EQU $000E
 0000                  27  PTDPUE  EQU $000F
                       28  
 0000                  29  SPCR    EQU $0010    ; SPI (Syncronous communication
                                                                             s)
 0000                  30  SPSCR   EQU $0011
 0000                  31  SPDR    EQU $0012
                       32  
 0000                  33  SCC1    EQU $0013    ; SCI (Asyncronous communicatio
                                                                            ns)
 0000                  34  SCC2    EQU $0014
 0000                  35  SCC3    EQU $0015
 0000                  36  SCS1    EQU $0016
 0000                  37  SCS2    EQU $0017
 0000                  38  SCDR    EQU $0018
 0000                  39  SCBR    EQU $0019
                       40  
 0000                  41  INTKBSCR EQU $001a   ; Keyboard interrupt control/st
                                                                           atus
 0000                  42  INTKBIER EQU $001b
                       43  
 0000                  44  TBCR    EQU $001c    ; Time base module
                       45  
 0000                  46  INTSCR  EQU $001d    ; IRQ status/control
                       47  
 0000                  48  CONFIG2 EQU $001e    ; System configuration
 0000                  49  CONFIG1 EQU $001f
                       50  
 0000                  51  T1SC    EQU $0020    ; Timer 1
 0000                  52  T1CNTH  EQU $0021
 0000                  53  T1CNTL  EQU $0022
 0000                  54  T1MODH  EQU $0023
 0000                  55  T1MODL  EQU $0024


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 2



 0000                  56  T1SC0   EQU $0025
 0000                  57  T1CH0H  EQU $0026
 0000                  58  T1CH0L  EQU $0027
 0000                  59  T1SC1   EQU $0028
 0000                  60  T1CH1H  EQU $0029
 0000                  61  T1CH1L  EQU $002a
                       62  
 0000                  63  T2SC    EQU $002b    ; Timer 2
 0000                  64  T2CNTH  EQU $002c
 0000                  65  T2CNTL  EQU $002d
 0000                  66  T2MODH  EQU $002e
 0000                  67  T2MODL  EQU $002f
 0000                  68  T2SC0   EQU $0030
 0000                  69  T2CH0H  EQU $0031
 0000                  70  T2CH0L  EQU $0032
 0000                  71  T2SC1   EQU $0033
 0000                  72  T2CH1H  EQU $0034
 0000                  73  T2CH1L  EQU $0035
                       74  
 0000                  75  PCTL    EQU $0036    ; GP32 Only - Phase lock loop 
                                                                 (for crystals)
 0000                  76  PBWC    EQU $0037    ; GP32 Only
 0000                  77  PMSH    EQU $0038    ; GP32 Only
 0000                  78  PMSL    EQU $0039    ; GP32 Only
 0000                  79  PMRS    EQU $003A    ; GP32 Only
 0000                  80  PMDS    EQU $003B    ; GP32 Only
                       81  
 0000                  82  ICGCR   EQU $0036    ; GT16 Only - Internal Clock 
                                                                      Generator
 0000                  83  ICGMR   EQU $0037    ; GT16 Only
 0000                  84  ICGTR   EQU $0038    ; GT16 Only
 0000                  85  ICGDVR  EQU $0039    ; GT16 Only
 0000                  86  ICGDSR  EQU $003A    ; GT16 Only
 0000                  87  ICGTR5  EQU $FF80    ; GT16 Only
 0000                  88  ICGTR3  EQU $FF81    ; GT16 Only
                       89  
 0000                  90  ADSCR   EQU $003C    ; A to D converter
 0000                  91  ADR     EQU $003D
 0000                  92  ADCLK   EQU $003E
                       93  
 0000                  94  SBSR    EQU $fe00    ; System integration
 0000                  95  SRSR    EQU $fe01
 0000                  96  SUBAR   EQU $fe02
 0000                  97  SBFCR   EQU $fe03
                       98  
 0000                  99  INT1    EQU $fe04    ; Interrupt status
 0000                 100  INT2    EQU $fe05
 0000                 101  INT3    EQU $fe06
                      102  
 0000                 103  FLTCR   EQU $fe07    ; Flash test/programming
 0000                 104  FLCR    EQU $fe08
                      105  
 0000                 106  BRKH    EQU $fe09    ; Hardware breakpoint
 0000                 107  BRKL    EQU $fe0a
 0000                 108  BRKSCR  EQU $fe0b
                      109  
 0000                 110  LVISR   EQU $fe0c    ; Low voltage detect
                      111  


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 3



 0000                 112  FLBPR   EQU $ff80    ; Flash boot protect
                      113  
 0000                 114  COPCTL  EQU $ffff    ; COP (Computer operating 
                                                              properly) control
                      115  
                      116  
                      117  
                      118  ; (C)opywrite P&E Microcomputer Systems, 1998, 2002
                      119  ; http://www.pemicro.com
                      120  
                      121  
 0000                 122  RAMStart     EQU  $0040
                      123  
 0000                 124  RomStart     EQU  $8000
                      125  
 0000                 126  VectorStart  EQU  $FFDC
                      127  
 0040                 128           org RamStart
 0040                 129  i        ds  1
 0041                 130  flags    ds  1
 0042                 131  time0    ds  1
 0043                 132  time1    ds  1
 0044                 133  time2    ds  1
 0045                 134  timer    ds  1
 0046                 135  temprd   ds  2
 0048      30313233   136  c0       db  '0123456789ABCDEF'
           34353637 
           38394142 
           43444546 
 0058                 137  i_byte   ds  1
 0059                 138  o_byte   ds  1
 005A                 139  _n       ds  1
 005B                 140  loop1    ds  1
 005C                 141  loop2    ds  1
 005D                 142  i1       ds  1
 005E                 143  numlh    ds  2
 0060                 144  a        ds  1
 0061                 145  tl       ds  1
 0062                 146  th       ds  1
 0063                 147  thou     ds  1
 0064                 148  hund     ds  1
 0065                 149  tens     ds  1
 0066                 150  ones     ds  1
 0067                 151  rab00    ds  1
 0068                 152  i2       ds  1
 0069                 153  r17      ds  1
 006A                 154  r18      ds  1
 006B                 155  r25      ds  1
 006C                 156  r26      ds  1
 006D                 157  row      ds  1
 006E                 158  col      ds  1
 006F                 159  ftim     ds  1
 0070                 160  ktim     ds  1
 0071                 161  keybl    ds  1
 0072                 162  lastrow  ds  1
 0073                 163  lastcol  ds  1
 0074                 164  rab01    ds  1
 0075      3134372E   165  tblkey   db  '147.2580369#'


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 4



           32353830 
           33363923 
 8000                 166           org RomStart
                      167  
                      168  ****************************************************
                                                                     **********
                      169  * Init_SCI - Turns on the asyncronous communications
                                                                      port    *
                      170  *            for "transmitting only" at 9600 baud 
                                                                   N81.       *
                      171  ****************************************************
                                                                     **********
                      172  Init_SCI:
 8000 [04] 6E0419     173           mov  #$04,SCBR       ; Baud Rate = 9600
 8003 [04] 6E4013     174           mov  #$40,SCC1       ; Enable the SCI 
                                                                     peripheral
 8006 [04] 6E0814     175           mov  #$08,SCC2       ; Enable the SCI 
                                                                    transmitter
 8009 [04] 81         176           rts
                      177  init_lcd:
 800A [04] 6E206B     178           mov  #$20,r25
 800D [05] CD83E2     179           jsr  i_com
 8010 [05] CD83CE     180           jsr  del
 8013 [04] 6E0F6B     181           mov  #$f,r25
 8016 [05] CD83E2     182           jsr  i_com
 8019 [05] CD83CE     183           jsr  del
 801C [04] 6E206B     184           mov  #$20,r25
 801F [05] CD83E2     185           jsr  i_com
 8022 [05] CD83CE     186           jsr  del
 8025 [04] 6E016B     187           mov  #$1,r25
 8028 [05] CD83E2     188           jsr  i_com
 802B [05] CD83D5     189           jsr  delay
 802E [04] 81         190           rts
                      191  start:
 802F [01] 9C         192           rsp
 8030 [01] 4F         193           clra                ; Initialize A,X so 
                                                                 that interrupt
 8031 [01] 5F         194           clrx                ; processing doesn't 
                                                                      stop with
                      195                               ; uninitialized 
                                                               register warning
                      196                               ; when push A,X on the 
                                                                          stack
 8032 [04] ADD6       197           bsr  init_lcd
 8034 [04] ADCA       198           bsr  Init_SCI       ; Initialize peripheral
                                                                              s
 8036 [03] 3F00       199           clr  PORTA
 8038 [04] 6E0E04     200           mov  #$0e,DDRA
 803B [04] 6EF10D     201           mov  #$f1,PTAPUE
 803E [03] 3F01       202           clr  PORTB
 8040 [03] 3F05       203           clr  DDRB
 8042 [03] 3F02       204           clr  PORTC
 8044 [04] 6E1F06     205           mov  #$1f,DDRC
 8047 [03] 3F03       206           clr  PORTD
 8049 [04] 6E0307     207           mov  #$03,DDRD
 804C [04] 6E3C0F     208           mov  #$3c,PTDPUE
 804F [03] 3F40       209           clr  i
 8051 [03] 3F41       210           clr  flags


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 5



 8053 [05] CD8342     211           jsr  start_ds
 8056 [03] 3F42       212           clr  time0
 8058 [03] 3F43       213           clr  time1
 805A [03] 3F44       214           clr  time2
 805C [03] 3F45       215           clr  timer
 805E [03] 3F6F       216           clr  ftim
 8060 [03] 3F70       217           clr  ktim
 8062 [03] 3F71       218           clr  keybl
 8064 [03] 3F72       219           clr  lastrow
 8066 [03] 3F73       220           clr  lastcol
 8068 [04] 6E3620     221           mov  #$36,T1SC     ;Tim1  Stopped i 
                                                                     Prescaler.
 806B [04] 1B20       222           bclr 5,T1SC        ;zapustili
 806D [02] 9A         223           cli                ; Allow interrupts to 
                                                                         happen
 806E [04] 1B41       224           bclr 5,flags
 8070 [04] 1741       225           bclr 3,flags
 8072 [04] 6E011E     226           mov  #$1,CONFIG2    ; For GP32 - SCI clock 
                                                                  source is Bus
 8075 [05] CD8342     227           jsr  start_ds
 8078 [02] A620       228           lda  #$20
                      229  mg00:
 807A [03] B541       230           bit  flags
 807C [03] 27FC       231           beq  mg00
 807E [05] CD8342     232           jsr  start_ds
 8081 [04] 1B41       233           bclr 5,flags
 8083 [02] A620       234           lda  #$20
                      235  mg01:
 8085 [03] B541       236           bit  flags
 8087 [03] 27FC       237           beq  mg01
                      238  update:
 8089 [05] 014102     239           brclr 0,flags,mg02
 808C [04] 1141       240           bclr 0,flags
                      241  *pereslat v kachestve granici
                      242  mg02:
                      243  *dobavit sravnenie i vkljuchenie vixoda
 808E [04] 1541       244           bclr 2,flags
 8090 [02] A608       245           lda  #$8
 8092 [03] B541       246           bit  flags
 8094 [03] 2709       247           beq  mg03
 8096 [04] 1E41       248           bset 7,flags
 8098 [05] CD8234     249           jsr  conv_t
 809B [04] 1F41       250           bclr 7,flags
 809D [04] 1741       251           bclr 3,flags
                      252  mg03:
 809F [02] A620       253           lda  #$20
 80A1 [03] B541       254           bit  flags
 80A3 [03] 27E4       255           beq  update
 80A5 [04] 1B41       256           bclr 5,flags
 80A7 [04] 1641       257           bset 3,flags
 80A9 [05] CD831D     258           jsr  read_t
 80AC [05] CD8342     259           jsr  start_ds
 80AF [02] A4FF       260           and  #$ff
 80B1 [03] 26D6       261           bne  update
 80B3 [04] 6E065D     262           mov  #6t,i1
 80B6 [02] A62D       263           lda  #$2d
 80B8 [01] 8C         264           clrh
 80B9 [02] AE48       265           ldx  #c0


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 6



 80BB [04] 1E41       266           bset 7,flags
                      267  mg04:
 80BD [02] F7         268           sta  ,x
 80BE [01] 5C         269           incx
 80BF [05] 3B5DFB     270           dbnz i1,mg04
 80C2 [04] 1F41       271           bclr 7,flags
 80C4 [03] 20C3       272           bra  update
                      273  ****************************************************
                                                                     **********
                      274  * T1_ISR - obrabotka Overflow Timera 1              
                                                                              *
                      275  ****************************************************
                                                                     **********
                      276  t1_isr:
 80C6 [02] 8B         277           pshh
 80C7 [03] B620       278           lda  T1SC
 80C9 [02] A47F       279           and  #$7f
 80CB [03] B720       280           sta  T1SC
 80CD [04] 3C42       281           inc  time0
 80CF [02] A664       282           lda  #100t
 80D1 [05] 314202     283           cbeq time0,mt100
 80D4 [03] 201A       284           bra  l22
                      285  mt100:
 80D6 [03] 3F42       286           clr  time0
 80D8 [04] 3C43       287           inc  time1
 80DA [04] 3C44       288           inc  time2
 80DC [02] A6BB       289           lda  #187t
 80DE [05] 314302     290           cbeq time1,mt101
 80E1 [03] 2002       291           bra  l18
                      292  mt101:
 80E3 [03] 3F43       293           clr  time1
                      294  l18:
 80E5 [02] A603       295           lda  #3t
 80E7 [05] 314402     296           cbeq time2,mt102
 80EA [03] 2004       297           bra  l22
                      298  mt102:
 80EC [03] 3F44       299           clr  time2
 80EE [04] 1A41       300           bset 5,flags
                      301  l22:
                      302  *zdes rabota s LCD i skanirov.klaviaturi
 80F0 [05] 0F4103     303           brclr 7,flags,key15
 80F3 [03] CC81A1     304           jmp  iret
                      305  key15:
 80F6 [01] 4F         306           clra
 80F7 [05] 317002     307           cbeq ktim,key00
 80FA [03] 2004       308           bra  key01
                      309  key00:
 80FC [03] 3F6D       310           clr  row
 80FE [03] 3F6E       311           clr  col
                      312  key01:
 8100 [05] 316F02     313           cbeq ftim,key02
 8103 [03] 2018       314           bra  key03
                      315  key02:
 8105 [01] 4F         316           clra
 8106 [05] 31700C     317           cbeq ktim,key04
 8109 [01] 4C         318           inca
 810A [05] 317004     319           cbeq ktim,key06
 810D [02] A608       320           lda  #$8


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 7



 810F [03] 2006       321           bra  key05
                      322  key06:
 8111 [02] A604       323           lda  #$4
 8113 [03] 2002       324           bra  key05
                      325  key04:
 8115 [02] A602       326           lda  #$2
                      327  key05:
 8117 [03] B700       328           sta  PORTA
 8119 [04] 3C6F       329           inc  ftim
 811B [03] 2061       330           bra  lcd00
                      331  key03:
 811D [03] 3F6F       332           clr  ftim
 811F [03] B600       333           lda  PORTA
 8121 [02] A4F0       334           and  #$f0
 8123 [03] 2705       335           beq  key07
 8125 [03] B76D       336           sta  row
 8127 [05] 4E706E     337           mov  ktim,col
                      338  key07:
 812A [04] 3C70       339           inc  ktim
 812C [02] A603       340           lda  #$3
 812E [05] 317002     341           cbeq ktim,key08
 8131 [03] 204B       342           bra  lcd00
                      343  key08:
 8133 [03] 3F70       344           clr  ktim
 8135 [01] 4F         345           clra
 8136 [05] 316D43     346           cbeq row,key09
 8139 [02] A606       347           lda  #$6
 813B [05] 317138     348           cbeq keybl,key10
 813E [03] B66D       349           lda  row
 8140 [05] 317202     350           cbeq lastrow,key11
 8143 [03] 200A       351           bra  key12
                      352  key11:
 8145 [03] B66E       353           lda  col
 8147 [05] 317302     354           cbeq lastcol,key13
 814A [03] 2003       355           bra  key12
                      356  key13:
 814C [01] 4F         357           clra
 814D [03] 202F       358           bra  lcd00
                      359  key12:
 814F [05] 4E6E73     360           mov  col,lastcol
 8152 [05] 4E6D72     361           mov  row,lastrow
 8155 [03] B66D       362           lda  row
 8157 [03] 3F74       363           clr  rab01
                      364  key14:
 8159 [04] 3C74       365           inc  rab01
 815B [01] 49         366           rola
 815C [03] 24FB       367           bcc  key14
 815E [04] 3A74       368           dec  rab01
 8160 [03] B66E       369           lda  col
 8162 [01] 48         370           asla
 8163 [01] 48         371           asla
 8164 [03] BA74       372           ora  rab01
 8166 [02] A10B       373           cmp  #$b
 8168 [03] 270C       374           beq  key10
 816A [01] 8C         375           clrh
 816B [01] 97         376           tax
 816C [03] E675       377           lda  tblkey,x
 816E [03] BE71       378           ldx  keybl


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 8



 8170 [03] E748       379           sta  c0,x
 8172 [04] 3C71       380           inc  keybl
 8174 [03] 2008       381           bra  lcd00
                      382  key10:
 8176 [03] 3F71       383           clr  keybl
 8178 [04] 1041       384           bset 0,flags
 817A [03] 2002       385           bra  lcd00
                      386  key09:
 817C [03] 3F72       387           clr  lastrow
                      388  lcd00:
 817E [04] 1203       389           bset 1,PORTD
 8180 [01] 8C         390           clrh
 8181 [03] BE40       391           ldx  i
 8183 [03] E648       392           lda  c0,x
 8185 [03] 62         393           nsa
 8186 [02] A40F       394           and  #$f
 8188 [02] AA10       395           ora  #$10
 818A [03] B702       396           sta  PORTC
 818C [04] 1902       397           bclr 4,PORTC
 818E [03] E648       398           lda  c0,x
 8190 [02] A40F       399           and  #$f
 8192 [02] AA10       400           ora  #$10
 8194 [03] B702       401           sta  PORTC
 8196 [04] 1902       402           bclr 4,PORTC
 8198 [04] 3C40       403           inc  i
 819A [05] 314002     404           cbeq i,lcd01
 819D [03] 2002       405           bra  iret
                      406  lcd01:
 819F [03] 3F40       407           clr  i
                      408  iret:
 81A1 [02] 8A         409           pulh
 81A2 [07] 80         410           rti
                      411  *podprogrammi
                      412  convert:
 81A3 [03] B75F       413           sta  numlh+1
 81A5 [02] AAF0       414           ora  #$f0
 81A7 [03] B763       415           sta  thou
 81A9 [03] BB63       416           add  thou
 81AB [05] 4E6367     417           mov  thou,rab00
 81AE [03] B763       418           sta  thou
 81B0 [03] B667       419           lda  rab00
 81B2 [02] ABE2       420           add  #$e2
 81B4 [03] B764       421           sta  hund
 81B6 [02] AB32       422           add  #$32
 81B8 [03] B766       423           sta  ones
 81BA [03] B65F       424           lda  numlh+1
 81BC [02] A40F       425           and  #$f
 81BE [03] B767       426           sta  rab00
 81C0 [03] BB64       427           add  hund
 81C2 [03] BB64       428           add  hund
 81C4 [03] B764       429           sta  hund
 81C6 [03] B667       430           lda  rab00
 81C8 [03] BB66       431           add  ones
 81CA [02] ABE9       432           add  #$e9
 81CC [03] B767       433           sta  rab00
 81CE [03] B765       434           sta  tens
 81D0 [03] BB65       435           add  tens
 81D2 [03] BB65       436           add  tens


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 9



 81D4 [03] B765       437           sta  tens
 81D6 [03] B65E       438           lda  numlh
 81D8 [02] A40F       439           and  #$f
 81DA [03] B75E       440           sta  numlh
 81DC [03] BB65       441           add  tens
 81DE [03] B765       442           sta  tens
 81E0 [03] B65E       443           lda  numlh
 81E2 [03] BB66       444           add  ones
 81E4 [03] B766       445           sta  ones
 81E6 [04] 3965       446           rol  tens
 81E8 [04] 3966       447           rol  ones
 81EA [04] 3366       448           com  ones
 81EC [04] 3966       449           rol  ones
 81EE [03] B667       450           lda  rab00
 81F0 [02] A40F       451           and  #$f
 81F2 [03] BB66       452           add  ones
 81F4 [03] B766       453           sta  ones
 81F6 [04] 3963       454           rol  thou
 81F8 [04] 6E0A67     455           mov  #$a,rab00
 81FB [03] B666       456           lda  ones
                      457  mcv02:
 81FD [03] BB67       458           add  rab00
 81FF [04] 3A65       459           dec  tens
 8201 [03] 24FA       460           bcc  mcv02
 8203 [03] B766       461           sta  ones
 8205 [03] B665       462           lda  tens
                      463  mcv03:
 8207 [03] BB67       464           add  rab00
 8209 [04] 3A64       465           dec  hund
 820B [03] 24FA       466           bcc  mcv03
 820D [03] B765       467           sta  tens
 820F [03] B664       468           lda  hund
                      469  mcv04:
 8211 [03] BB67       470           add  rab00
 8213 [04] 3A63       471           dec  thou
 8215 [03] 24FA       472           bcc  mcv04
 8217 [03] B764       473           sta  hund
 8219 [03] B663       474           lda  thou
                      475  mcv05:
 821B [03] BB67       476           add  rab00
 821D [03] 24FC       477           bcc  mcv05
 821F [03] B763       478           sta  thou
 8221 [04] 6E0368     479           mov  #3t,i2
 8224 [01] 8C         480           clrh
 8225 [02] AE63       481           ldx  #thou
                      482  mcv00:
 8227 [02] F6         483           lda  ,x
 8228 [02] A40F       484           and  #$f
 822A [03] 2607       485           bne  mcv01
 822C [02] A60A       486           lda  #$a
 822E [02] F7         487           sta  ,x
 822F [01] 5C         488           incx
 8230 [05] 3B68F4     489           dbnz i2,mcv00
                      490  mcv01:
 8233 [04] 81         491           rts
                      492  conv_t:
 8234 [05] 4E465E     493           mov  temprd,numlh
 8237 [05] 4E475F     494           mov  temprd+1,numlh+1


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 10



 823A [05] 0F471F     495           brclr 7,temprd+1,mcnv00
 823D [04] 6E0460     496           mov  #$4,a
                      497  mcnv01:
 8240 [01] 98         498           clc
 8241 [04] 365F       499           ror  numlh+1
 8243 [04] 365E       500           ror  numlh
 8245 [05] 3B60F8     501           dbnz a,mcnv01
 8248 [02] A6FF       502           lda  #$ff
 824A [03] B05E       503           sub  numlh
 824C [03] B762       504           sta  th
 824E [03] B646       505           lda  temprd
 8250 [02] A40F       506           and  #$f
 8252 [03] B75F       507           sta  numlh+1
 8254 [02] A6FF       508           lda  #$ff
 8256 [03] B05F       509           sub  numlh+1
 8258 [02] A40F       510           and  #$f
 825A [03] 2012       511           bra  mcnv03
                      512  mcnv00:
 825C [04] 6E0460     513           mov  #$4,a
                      514  mcnv02:
 825F [01] 98         515           clc
 8260 [04] 365F       516           ror  numlh+1
 8262 [04] 365E       517           ror  numlh
 8264 [05] 3B60F8     518           dbnz a,mcnv02
 8267 [05] 4E5E62     519           mov  numlh,th
 826A [03] B646       520           lda  temprd
 826C [02] A40F       521           and  #$f
                      522  mcnv03:
 826E [03] B75E       523           sta  numlh
 8270 [03] 3F5F       524           clr  numlh+1
 8272 [04] 6E0660     525           mov  #6t,a
 8275 [01] 4F         526           clra
                      527  mcnv04:
 8276 [03] BB5E       528           add  numlh
 8278 [05] 3B60FB     529           dbnz a,mcnv04
 827B [03] B75E       530           sta  numlh
 827D [05] CD81A3     531           jsr  convert
 8280 [02] A60A       532           lda  #$a
 8282 [05] 316502     533           cbeq tens,mcnv05
 8285 [03] 2002       534           bra  mcnv06
 8287 [03] 3F65       535  mcnv05:  clr  tens
 8289 [03] B666       536  mcnv06:  lda  ones
 828B [02] A105       537           cmp  #$5
 828D [03] 2502       538           bcs  mcnv07
 828F [04] 3C65       539           inc  tens
                      540  mcnv07:
 8291 [05] 4E6561     541           mov  tens,tl
 8294 [05] 0F4760     542           brclr 7,temprd+1,mcnv08
                      543  mcnv11:
 8297 [02] A663       544           lda  #99t
 8299 [03] B062       545           sub  th
 829B [03] 2426       546           bcc  mcnv09
 829D [03] B662       547           lda  th
 829F [05] 4E625E     548           mov  th,numlh
 82A2 [03] 3F5F       549           clr  numlh+1
 82A4 [05] CD81A3     550           jsr  convert
 82A7 [04] 6E2048     551           mov  #$20,c0
 82AA [04] 6E304D     552           mov  #$30,c0+5


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 11



 82AD [04] 6E2E4C     553           mov  #$2e,c0+4
 82B0 [03] B666       554           lda  ones
 82B2 [02] AB30       555           add  #$30
 82B4 [03] B74B       556           sta  c0+3
 82B6 [03] B665       557           lda  tens
 82B8 [02] AB30       558           add  #$30
 82BA [03] B74A       559           sta  c0+2
 82BC [03] B664       560           lda  hund
 82BE [02] AB30       561           add  #$30
 82C0 [03] B749       562           sta  c0+1
 82C2 [04] 81         563           rts
                      564  mcnv09:
 82C3 [03] B661       565           lda  tl
 82C5 [05] 4E615E     566           mov  tl,numlh
 82C8 [03] 3F5F       567           clr  numlh+1
 82CA [05] CD81A3     568           jsr  convert
 82CD [04] 6E2E4C     569           mov  #$2e,c0+4
 82D0 [03] B666       570           lda  ones
 82D2 [02] AB30       571           add  #$30
 82D4 [03] B74D       572           sta  c0+5
 82D6 [05] 4E625E     573           mov  th,numlh
 82D9 [03] 3F5F       574           clr  numlh+1
 82DB [05] CD81A3     575           jsr  convert
 82DE [03] B666       576           lda  ones
 82E0 [02] AB30       577           add  #$30
 82E2 [03] B74B       578           sta  c0+3
 82E4 [03] B665       579           lda  tens
 82E6 [02] AB30       580           add  #$30
 82E8 [03] B74A       581           sta  c0+2
 82EA [04] 6E2049     582           mov  #$20,c0+1
 82ED [04] 6E2048     583           mov  #$20,c0
 82F0 [05] 0F4703     584           brclr 7,temprd+1,mcnv10
 82F3 [04] 6E2D48     585           mov  #$2d,c0
                      586  mcnv10:
 82F6 [04] 81         587           rts
                      588  mcnv08:
 82F7 [02] A613       589           lda  #19t
 82F9 [03] B062       590           sub  th
 82FB [03] 249A       591           bcc  mcnv11
 82FD [03] B662       592           lda  th
 82FF [05] 4E625E     593           mov  th,numlh
 8302 [03] 3F5F       594           clr  numlh+1
 8304 [05] CD81A3     595           jsr  convert
 8307 [04] 6E304D     596           mov  #$30,c0+5
 830A [04] 6E2E4C     597           mov  #$2e,c0+4
 830D [04] 6E2D48     598           mov  #$2d,c0
 8310 [03] B666       599           lda  ones
 8312 [02] AB30       600           add  #$30
 8314 [03] B74A       601           sta  c0+2
 8316 [03] B665       602           lda  tens
 8318 [02] AB30       603           add  #$30
 831A [03] B749       604           sta  c0+1
 831C [04] 81         605           rts
                      606  read_t:
 831D [04] AD32       607           bsr  init
 831F [04] 6ECC59     608           mov  #$cc,o_byte
 8322 [04] AD60       609           bsr  out_byte
 8324 [04] 6EBE59     610           mov  #$be,o_byte


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 12



 8327 [04] AD5B       611           bsr  out_byte
 8329 [04] AD35       612           bsr  in_byte
 832B [03] B746       613           sta  temprd
 832D [04] AD31       614           bsr  in_byte
 832F [03] B747       615           sta  temprd+1
 8331 [04] AD2D       616           bsr  in_byte
 8333 [04] AD2B       617           bsr  in_byte
 8335 [04] AD29       618           bsr  in_byte
 8337 [04] AD27       619           bsr  in_byte
 8339 [04] AD25       620           bsr  in_byte
 833B [04] AD23       621           bsr  in_byte
 833D [04] AD21       622           bsr  in_byte
 833F [02] A6FF       623           lda  #$ff
 8341 [04] 81         624           rts
                      625  start_ds:
 8342 [04] AD0D       626           bsr  init
 8344 [04] 6ECC59     627           mov  #$cc,o_byte
 8347 [04] AD3B       628           bsr  out_byte
 8349 [04] 6E4459     629           mov  #$44,o_byte
 834C [04] AD36       630           bsr  out_byte
 834E [02] A6FF       631           lda  #$ff
 8350 [04] 81         632           rts
                      633  init:
 8351 [04] AD4E       634           bsr  pin_hi
 8353 [04] AD51       635           bsr  pin_lo
 8355 [02] A632       636           lda  #50t
 8357 [04] AD68       637           bsr  del_10mk
 8359 [04] AD46       638           bsr  pin_hi
 835B [02] A632       639           lda  #50t
 835D [04] AD62       640           bsr  del_10mk
 835F [04] 81         641           rts
                      642  in_byte:
 8360 [04] 6E085A     643           mov  #8t,_n
 8363 [03] 3F58       644           clr  i_byte
                      645  min00
 8365 [04] AD3F       646           bsr  pin_lo
 8367 [01] 9D         647           nop
 8368 [04] AD37       648           bsr  pin_hi
 836A [01] 9D         649           nop
 836B [01] 9D         650           nop
 836C [01] 9D         651           nop
 836D [01] 9D         652           nop
 836E [01] 9D         653           nop
 836F [01] 9D         654           nop
 8370 [02] A604       655           lda  #$4
 8372 [03] B503       656           bit  PORTD
 8374 [01] 98         657           clc
 8375 [03] 2701       658           beq  min01
 8377 [01] 99         659           sec
                      660  min01:
 8378 [04] 3658       661           ror  i_byte
 837A [02] A606       662           lda  #6t
 837C [04] AD43       663           bsr  del_10mk
 837E [05] 3B5AE4     664           dbnz _n,min00
 8381 [03] B658       665           lda  i_byte
 8383 [04] 81         666           rts
                      667  out_byte:
 8384 [04] 6E085A     668           mov  #8t,_n


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 13



                      669  mou03:
 8387 [04] 3659       670           ror  o_byte
 8389 [03] 240C       671           bcc  mou00
 838B [04] AD19       672           bsr  pin_lo
 838D [04] AD12       673           bsr  pin_hi
 838F [02] A606       674           lda  #6t
 8391 [04] AD2E       675           bsr  del_10mk
                      676  mou02:
 8393 [05] 3B5AF1     677           dbnz _n,mou03
 8396 [04] 81         678           rts
 8397 [04] AD0D       679  mou00:   bsr  pin_lo
 8399 [02] A606       680           lda  #6t
 839B [04] AD24       681           bsr  del_10mk
 839D [04] AD02       682           bsr  pin_hi
 839F [03] 20F2       683           bra  mou02
                      684  pin_hi:
 83A1 [02] 9B         685           sei
 83A2 [04] 1507       686           bclr 2,DDRD
 83A4 [02] 9A         687           cli
 83A5 [04] 81         688           rts
                      689  pin_lo:
 83A6 [02] 9B         690           sei
 83A7 [04] 1503       691           bclr 2,PORTD
 83A9 [04] 1407       692           bset 2,DDRD
 83AB [02] 9A         693           cli
 83AC [04] 81         694           rts
                      695  dellng:
 83AD [02] A6FA       696           lda  #250t
                      697  del_n_ms:
 83AF [03] B75B       698           sta  loop1
                      699  outter:
 83B1 [04] 6E6E5C     700           mov  #110t,loop2
                      701  inner:
 83B4 [01] 9D         702           nop
 83B5 [01] 9D         703           nop
 83B6 [01] 9D         704           nop
 83B7 [01] 9D         705           nop
 83B8 [01] 9D         706           nop
 83B9 [01] 9D         707           nop
 83BA [05] 3B5CF7     708           dbnz loop2,inner
 83BD [05] 3B5BF1     709           dbnz loop1,outter
 83C0 [04] 81         710           rts
                      711  del_10mk:
 83C1 [03] B75B       712           sta  loop1
                      713  mdel00:
 83C3 [01] 9D         714           nop
 83C4 [01] 9D         715           nop
 83C5 [01] 9D         716           nop
 83C6 [01] 9D         717           nop
 83C7 [01] 9D         718           nop
 83C8 [01] 9D         719           nop
 83C9 [01] 9D         720           nop
 83CA [05] 3B5BF6     721           dbnz loop1,mdel00
 83CD [04] 81         722           rts
                      723  del:
 83CE [04] 6E326A     724           mov  #50t,r18
                      725  mmdl00:
 83D1 [05] 3B6AFD     726           dbnz r18,mmdl00


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 14



 83D4 [04] 81         727           rts
                      728  delay:
 83D5 [04] 6E0969     729           mov  #9t,r17
                      730  mlay00:
 83D8 [04] 6EFF6A     731           mov  #255t,r18
                      732  mlay01:
 83DB [05] 3B6AFD     733           dbnz r18,mlay01
 83DE [05] 3B69F7     734           dbnz r17,mlay00
 83E1 [04] 81         735           rts
                      736  i_com:
 83E2 [04] 1103       737           bclr 0,PORTD
 83E4 [04] 1303       738           bclr 1,PORTD
 83E6 [03] B66B       739           lda  r25
 83E8 [03] 62         740           nsa
 83E9 [02] A40F       741           and  #$f
 83EB [02] AA10       742           ora  #$10
 83ED [03] B702       743           sta  PORTC
 83EF [04] 1902       744           bclr 4,PORTC
 83F1 [03] B66B       745           lda  r25
 83F3 [02] A40F       746           and  #$f
 83F5 [02] AA10       747           ora  #$10
 83F7 [03] B702       748           sta  PORTC
 83F9 [04] 1902       749           bclr 4,PORTC
 83FB [04] 81         750           rts
                      751  
                      752  ****************************************************
                                                                     **********
                      753  * DUMMY_ISR - Dummy Interrupt Service Routine.      
                                                                              *
                      754  *             Just does a return from interrupt.    
                                                                              *
                      755  ****************************************************
                                                                     **********
                      756  dummy_isr:
                      757  
 83FC [07] 80         758           rti           ; return
                      759  
                      760  ****************************************************
                                                                     **********
                      761  * Vectors - Timer Interrupt Service Routine.        
                                                                              *
                      762  *             after a RESET.                        
                                                                              *
                      763  ****************************************************
                                                                     **********
 FFDC                 764           org  VectorStart
                      765  
 FFDC      83FC       766           dw  dummy_isr    ; Time Base Vector
 FFDE      83FC       767           dw  dummy_isr    ; ADC Conversion Complete
 FFE0      83FC       768           dw  dummy_isr    ; Keyboard Vector
 FFE2      83FC       769           dw  dummy_isr    ; SCI Transmit Vector
 FFE4      83FC       770           dw  dummy_isr    ; SCI Receive Vector
 FFE6      83FC       771           dw  dummy_isr    ; SCI Error Vector
 FFE8      83FC       772           dw  dummy_isr    ; SPI Transmit Vector
 FFEA      83FC       773           dw  dummy_isr    ; SPI Receive Vector
 FFEC      83FC       774           dw  dummy_isr    ; TIM2 Overflow Vector
 FFEE      83FC       775           dw  dummy_isr    ; TIM2 Channel 1 Vector
 FFF0      83FC       776           dw  dummy_isr    ; TIM2 Channel 0 Vector


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 15



 FFF2      80C6       777           dw  t1_isr       ; TIM1 Overflow Vector
 FFF4      83FC       778           dw  dummy_isr    ; TIM1 Channel 1 Vector
 FFF6      83FC       779           dw  dummy_isr    ; TIM1 Channel 0 Vector
 FFF8      83FC       780           dw  dummy_isr    ; ICG/CGM Vector
 FFFA      83FC       781           dw  dummy_isr    ; ~IRQ1 Vector
 FFFC      83FC       782           dw  dummy_isr    ; SWI Vector
 FFFE      802F       783           dw  start        ; Reset Vector
                      784  ;programma kursovoj raboti
                      785  
                      786   

 Symbol Table 

A                0060
ADCLK            003E
ADR              003D
ADSCR            003C
BRKH             FE09
BRKL             FE0A
BRKSCR           FE0B
C0               0048
COL              006E
CONFIG1          001F
CONFIG2          001E
CONVERT          81A3
CONV_T           8234
COPCTL           FFFF
DDRA             0004
DDRB             0005
DDRC             0006
DDRD             0007
DDRE             000C
DEL              83CE
DELAY            83D5
DELLNG           83AD
DEL_10MK         83C1
DEL_N_MS         83AF
DUMMY_ISR        83FC
FLAGS            0041
FLBPR            FF80
FLCR             FE08
FLTCR            FE07
FTIM             006F
HUND             0064
I                0040
I1               005D
I2               0068
ICGCR            0036
ICGDSR           003A
ICGDVR           0039
ICGMR            0037
ICGTR            0038
ICGTR3           FF81
ICGTR5           FF80
INIT             8351
INIT_LCD         800A
INIT_SCI         8000
INNER            83B4


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 16



INT1             FE04
INT2             FE05
INT3             FE06
INTKBIER         001B
INTKBSCR         001A
INTSCR           001D
IN_BYTE          8360
IRET             81A1
I_BYTE           0058
I_COM            83E2
KEY00            80FC
KEY01            8100
KEY02            8105
KEY03            811D
KEY04            8115
KEY05            8117
KEY06            8111
KEY07            812A
KEY08            8133
KEY09            817C
KEY10            8176
KEY11            8145
KEY12            814F
KEY13            814C
KEY14            8159
KEY15            80F6
KEYBL            0071
KTIM             0070
L18              80E5
L22              80F0
LASTCOL          0073
LASTROW          0072
LCD00            817E
LCD01            819F
LOOP1            005B
LOOP2            005C
LVISR            FE0C
MCNV00           825C
MCNV01           8240
MCNV02           825F
MCNV03           826E
MCNV04           8276
MCNV05           8287
MCNV06           8289
MCNV07           8291
MCNV08           82F7
MCNV09           82C3
MCNV10           82F6
MCNV11           8297
MCV00            8227
MCV01            8233
MCV02            81FD
MCV03            8207
MCV04            8211
MCV05            821B
MDEL00           83C3
MG00             807A
MG01             8085


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 17



MG02             808E
MG03             809F
MG04             80BD
MIN00            8365
MIN01            8378
MLAY00           83D8
MLAY01           83DB
MMDL00           83D1
MOU00            8397
MOU02            8393
MOU03            8387
MT100            80D6
MT101            80E3
MT102            80EC
NUMLH            005E
ONES             0066
OUTTER           83B1
OUT_BYTE         8384
O_BYTE           0059
PBWC             0037
PCTL             0036
PIN_HI           83A1
PIN_LO           83A6
PMDS             003B
PMRS             003A
PMSH             0038
PMSL             0039
PORTA            0000
PORTB            0001
PORTC            0002
PORTD            0003
PORTE            0008
PTA              0000
PTAPUE           000D
PTB              0001
PTC              0002
PTCPUE           000E
PTD              0003
PTDPUE           000F
PTE              0008
R17              0069
R18              006A
R25              006B
R26              006C
RAB00            0067
RAB01            0074
RAMSTART         0040
READ_T           831D
ROMSTART         8000
ROW              006D
SBFCR            FE03
SBSR             FE00
SCBR             0019
SCC1             0013
SCC2             0014
SCC3             0015
SCDR             0018
SCIACTL          000A


B16a01.asm             Assembled with CASM08Z  30.05.04  0:09:57  PAGE 18



SCIADAT          000B
SCPSC            0009
SCS1             0016
SCS2             0017
SPCR             0010
SPDR             0012
SPSCR            0011
SRSR             FE01
START            802F
START_DS         8342
SUBAR            FE02
T1CH0H           0026
T1CH0L           0027
T1CH1H           0029
T1CH1L           002A
T1CNTH           0021
T1CNTL           0022
T1MODH           0023
T1MODL           0024
T1SC             0020
T1SC0            0025
T1SC1            0028
T1_ISR           80C6
T2CH0H           0031
T2CH0L           0032
T2CH1H           0034
T2CH1L           0035
T2CNTH           002C
T2CNTL           002D
T2MODH           002E
T2MODL           002F
T2SC             002B
T2SC0            0030
T2SC1            0033
TBCR             001C
TBLKEY           0075
TEMPRD           0046
TENS             0065
TH               0062
THOU             0063
TIME0            0042
TIME1            0043
TIME2            0044
TIMER            0045
TL               0061
UPDATE           8089
VECTORSTART      FFDC
_N               005A
